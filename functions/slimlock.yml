---
- hosts: local
  tasks:
  - name: ensure libselinux-python is installed at the latest version
    become: yes
    dnf: state=latest name={{ item }}
    with_items:
      - libselinux-python # used for file permisions not sure why ^^ 
  # https://github.com/ansible/ansible-modules-core/issues/5592
  - name: ensure that the slimlock dir don't exist
    file: path=/usr/local/src/slimlock state=absent
  - name: clone slimlock
    become: yes
    git: repo=https://github.com/dannyn/slimlock force=yes dest=/usr/local/src/slimlock
  - name: ensure that the folder has the right permisions
    become: yes
    file: path=/usr/local/src/slimlock owner=l33tname group=l33tname mode=0755
  # install missing pkgs
  - name: build slimlock
    command: make chdir=/usr/local/src/slimlock
  # copy the configs and stuff
  # mv ../config/slim /usr/share
  - name: install slimlock 
    become: yes
    command: make install chdir=/usr/local/src/slimlock
  - name: copy the slimlock wrapper script with conky
    become: yes
    template: src=../config/scripts/slimlocky.tpl dest=/usr/local/bin/slimlocky
  - name: ensure file that the script has the right permisions
    become: yes
    file: path=/usr/local/bin/slimlocky owner=root group=root mode=0755
